import{r as f,K as ie,L as ce,j as d,A as q,o as _,c as me,G as h,T as B,f as t,d as e,e as a,k as C,p as i,l as v,R as F,m as U,D as z,x as fe,a0 as _e,O as he,v as ve}from"./index-Bt1HRCNa.js";import{l as ge,g as be,u as ye,a as Ve,d as we}from"./chapters-_F7Z6Ro_.js";const Ue={class:"app-container"},Ce=U("div",{class:"el-upload__text"},[i(" Drop file here or "),U("em",null,"click to upload")],-1),De=U("div",{class:"el-upload__tip"}," 上传mp4文件，最大200MB ",-1),ke={class:"dialog-footer"},Ie=fe({name:"Chapters"}),xe=Object.assign(Ie,{setup(Se){const{proxy:g}=ve(),$=f([]),b=f(!1),S=f(!0),D=f(!0),A=f([]),Y=f(!0),E=f(!0),T=f(0),x=f(""),k=ie({form:{},queryParams:{pageNum:1,pageSize:10,courseId:null,chapterTitle:null,chapterDescription:null,videoUrl:null,position:null,createdAt:null,updatedAt:null},rules:{}}),{queryParams:r,form:u,rules:L}=ce(k),Q="http://localhost:9800";f([]);const j=async n=>{const l=new FormData;l.append("file",n.file);try{const p=await _e.post(`${Q}/file/upload`,l,{headers:{"Content-Type":"multipart/form-data"}}).then(s=>{k.form.videoUrl=s.data,console.log(k.form.videoUrl)});n.onSuccess&&n.onSuccess(p.data)}catch(p){n.onError&&n.onError(p)}},O=n=>{console.log("上传成功"+n),he({message:"上传成功",type:"success"})};function y(){S.value=!0,ge(r.value).then(n=>{$.value=n.rows,T.value=n.total,S.value=!1})}function G(){b.value=!1,R()}function R(){u.value={chapterId:null,courseId:null,chapterTitle:null,chapterDescription:null,videoUrl:null,position:null,createdAt:null,updatedAt:null},g.resetForm("chaptersRef")}function V(){r.value.pageNum=1,y()}function H(){g.resetForm("queryRef"),V()}function J(n){A.value=n.map(l=>l.chapterId),Y.value=n.length!=1,E.value=!n.length}function W(){R(),b.value=!0,x.value="添加course_chapters"}function K(n){R();const l=n.chapterId||A.value;be(l).then(p=>{u.value=p.data,b.value=!0,x.value="修改course_chapters"})}function X(){g.$refs.chaptersRef.validate(n=>{n&&(u.value.chapterId!=null?ye(u.value).then(l=>{g.$modal.msgSuccess("修改成功"),b.value=!1,y()}):Ve(u.value).then(l=>{g.$modal.msgSuccess("新增成功"),b.value=!1,y()}))})}function N(n){const l=n.chapterId||A.value;g.$modal.confirm('是否确认删除course_chapters编号为"'+l+'"的数据项？').then(function(){return we(l)}).then(()=>{y(),g.$modal.msgSuccess("删除成功")}).catch(()=>{})}function Z(){g.download("course/chapters/export",{...r.value},`chapters_${new Date().getTime()}.xlsx`)}return y(),(n,l)=>{const p=d("el-input"),s=d("el-form-item"),M=d("el-date-picker"),c=d("el-button"),P=d("el-form"),I=d("el-col"),ee=d("right-toolbar"),le=d("el-row"),m=d("el-table-column"),te=d("el-table"),ae=d("pagination"),oe=d("el-tag"),ne=d("upload-filled"),re=d("el-icon"),de=d("el-upload"),pe=d("el-dialog"),w=q("hasPermi"),se=q("loading");return _(),me("div",Ue,[h(e(P,{model:t(r),ref:"queryRef",inline:!0,"label-width":"68px"},{default:a(()=>[e(s,{label:"课程id",prop:"courseId"},{default:a(()=>[e(p,{modelValue:t(r).courseId,"onUpdate:modelValue":l[0]||(l[0]=o=>t(r).courseId=o),placeholder:"请输入课程id",clearable:"",onKeyup:C(V,["enter"])},null,8,["modelValue"])]),_:1}),e(s,{label:"章节标题",prop:"chapterTitle"},{default:a(()=>[e(p,{modelValue:t(r).chapterTitle,"onUpdate:modelValue":l[1]||(l[1]=o=>t(r).chapterTitle=o),placeholder:"请输入章节标题",clearable:"",onKeyup:C(V,["enter"])},null,8,["modelValue"])]),_:1}),e(s,{label:"章节描述",prop:"chapterDescription"},{default:a(()=>[e(p,{modelValue:t(r).chapterDescription,"onUpdate:modelValue":l[2]||(l[2]=o=>t(r).chapterDescription=o),placeholder:"请输入章节描述",clearable:"",onKeyup:C(V,["enter"])},null,8,["modelValue"])]),_:1}),e(s,{label:"视频链接",prop:"videoUrl"},{default:a(()=>[e(p,{modelValue:t(r).videoUrl,"onUpdate:modelValue":l[3]||(l[3]=o=>t(r).videoUrl=o),placeholder:"请输入视频链接",clearable:"",onKeyup:C(V,["enter"])},null,8,["modelValue"])]),_:1}),e(s,{label:"章节顺序",prop:"position"},{default:a(()=>[e(p,{modelValue:t(r).position,"onUpdate:modelValue":l[4]||(l[4]=o=>t(r).position=o),placeholder:"请输入章节顺序",clearable:"",onKeyup:C(V,["enter"])},null,8,["modelValue"])]),_:1}),e(s,{label:"创建时间",prop:"createdAt"},{default:a(()=>[e(M,{clearable:"",modelValue:t(r).createdAt,"onUpdate:modelValue":l[5]||(l[5]=o=>t(r).createdAt=o),type:"date","value-format":"YYYY-MM-DD",placeholder:"请选择创建时间"},null,8,["modelValue"])]),_:1}),e(s,{label:"更新时间",prop:"updatedAt"},{default:a(()=>[e(M,{clearable:"",modelValue:t(r).updatedAt,"onUpdate:modelValue":l[6]||(l[6]=o=>t(r).updatedAt=o),type:"date","value-format":"YYYY-MM-DD",placeholder:"请选择更新时间"},null,8,["modelValue"])]),_:1}),e(s,null,{default:a(()=>[e(c,{type:"primary",icon:"Search",onClick:V},{default:a(()=>[i("搜索")]),_:1}),e(c,{icon:"Refresh",onClick:H},{default:a(()=>[i("重置")]),_:1})]),_:1})]),_:1},8,["model"]),[[B,t(D)]]),e(le,{gutter:10,class:"mb8"},{default:a(()=>[e(I,{span:1.5},{default:a(()=>[h((_(),v(c,{type:"primary",plain:"",icon:"Plus",onClick:W},{default:a(()=>[i("新增 ")]),_:1})),[[w,["course:chapters:add"]]])]),_:1}),e(I,{span:1.5},{default:a(()=>[h((_(),v(c,{type:"success",plain:"",icon:"Edit",disabled:t(Y),onClick:K},{default:a(()=>[i("修改 ")]),_:1},8,["disabled"])),[[w,["course:chapters:edit"]]])]),_:1}),e(I,{span:1.5},{default:a(()=>[h((_(),v(c,{type:"danger",plain:"",icon:"Delete",disabled:t(E),onClick:N},{default:a(()=>[i("删除 ")]),_:1},8,["disabled"])),[[w,["course:chapters:remove"]]])]),_:1}),e(I,{span:1.5},{default:a(()=>[h((_(),v(c,{type:"warning",plain:"",icon:"Download",onClick:Z},{default:a(()=>[i("导出 ")]),_:1})),[[w,["course:chapters:export"]]])]),_:1}),e(ee,{showSearch:t(D),"onUpdate:showSearch":l[7]||(l[7]=o=>F(D)?D.value=o:null),onQueryTable:y},null,8,["showSearch"])]),_:1}),h((_(),v(te,{data:t($),onSelectionChange:J},{default:a(()=>[e(m,{type:"selection",width:"55",align:"center"}),e(m,{label:"章节id",align:"center",prop:"chapterId"}),e(m,{label:"课程id",align:"center",prop:"courseId"}),e(m,{label:"章节标题",align:"center",prop:"chapterTitle"}),e(m,{label:"章节描述",align:"center",prop:"chapterDescription","show-overflow-tooltip":""}),e(m,{label:"视频链接",align:"center",prop:"videoUrl","show-overflow-tooltip":""}),e(m,{label:"章节顺序",align:"center",prop:"position"}),e(m,{label:"创建时间",align:"center",prop:"createdAt",width:"180"},{default:a(o=>[U("span",null,z(n.parseTime(o.row.createdAt,"{y}-{m}-{d}")),1)]),_:1}),e(m,{label:"更新时间",align:"center",prop:"updatedAt",width:"180"},{default:a(o=>[U("span",null,z(n.parseTime(o.row.updatedAt,"{y}-{m}-{d}")),1)]),_:1}),e(m,{label:"操作",align:"center","class-name":"small-padding fixed-width"},{default:a(o=>[h((_(),v(c,{link:"",type:"primary",icon:"Edit",onClick:ue=>K(o.row)},{default:a(()=>[i("修改 ")]),_:2},1032,["onClick"])),[[w,["course:chapters:edit"]]]),h((_(),v(c,{link:"",type:"primary",icon:"Delete",onClick:ue=>N(o.row)},{default:a(()=>[i("删除 ")]),_:2},1032,["onClick"])),[[w,["course:chapters:remove"]]])]),_:1})]),_:1},8,["data"])),[[se,t(S)]]),h(e(ae,{total:t(T),page:t(r).pageNum,"onUpdate:page":l[8]||(l[8]=o=>t(r).pageNum=o),limit:t(r).pageSize,"onUpdate:limit":l[9]||(l[9]=o=>t(r).pageSize=o),onPagination:y},null,8,["total","page","limit"]),[[B,t(T)>0]]),e(pe,{title:t(x),modelValue:t(b),"onUpdate:modelValue":l[14]||(l[14]=o=>F(b)?b.value=o:null),width:"500px","append-to-body":""},{footer:a(()=>[U("div",ke,[e(c,{type:"primary",onClick:X},{default:a(()=>[i("确 定")]),_:1}),e(c,{onClick:G},{default:a(()=>[i("取 消")]),_:1})])]),default:a(()=>[e(P,{ref:"chaptersRef",model:t(u),rules:t(L),"label-width":"80px"},{default:a(()=>[e(s,{label:"课程id",prop:"courseId"},{default:a(()=>[e(p,{modelValue:t(u).courseId,"onUpdate:modelValue":l[10]||(l[10]=o=>t(u).courseId=o),placeholder:"请输入课程id"},null,8,["modelValue"])]),_:1}),e(s,{label:"章节标题",prop:"chapterTitle"},{default:a(()=>[e(p,{modelValue:t(u).chapterTitle,"onUpdate:modelValue":l[11]||(l[11]=o=>t(u).chapterTitle=o),placeholder:"请输入章节标题"},null,8,["modelValue"])]),_:1}),e(s,{label:"章节描述",prop:"chapterDescription"},{default:a(()=>[e(p,{modelValue:t(u).chapterDescription,"onUpdate:modelValue":l[12]||(l[12]=o=>t(u).chapterDescription=o),placeholder:"请输入章节描述"},null,8,["modelValue"])]),_:1}),e(s,{label:"视频文件",prop:"videoUrl"},{default:a(()=>[t(k).form.videoUrl?(_(),v(oe,{key:0},{default:a(()=>[i("已上传")]),_:1})):(_(),v(de,{key:1,class:"upload-demo",drag:"",action:"https://run.mocky.io/v3/9d059bf9-4660-45f2-925d-ce80ad6c4d15",multiple:"","http-request":j,"on-success":O},{tip:a(()=>[De]),default:a(()=>[e(re,{class:"el-icon--upload"},{default:a(()=>[e(ne)]),_:1}),Ce]),_:1}))]),_:1}),e(s,{label:"章节顺序",prop:"position"},{default:a(()=>[e(p,{modelValue:t(u).position,"onUpdate:modelValue":l[13]||(l[13]=o=>t(u).position=o),placeholder:"请输入章节顺序"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])}}});export{xe as default};
