import{x as E,r as o,E as S,y as D,z as F,j as $,A as K,o as d,c as b,d as h,e as _,p as k,l as B,n as P,m as I,F as R,B as U,C as z,D as O,G,_ as H}from"./index-D_Na45nS.js";const J={class:"time"},L=E({__name:"chatRoom",setup(j){const e=o(null),y=o(Math.random().toString(36).substr(2)),l=o(""),i=o(""),n=o([]),v=o(!1),g=o(!1),m=o(null);"WebSocket"in window?e.value=new WebSocket(`ws://localhost:9800/ws/${courseId.value}+${chapterId.value}+${y.value}`):S.alert("æµè§ˆå™¨ä¸æ”¯æŒåœ¨çº¿èŠå¤©","ğŸ˜£",{confirmButtonText:"OK"});const x=()=>{n.value.push({text:"error",isMine:!1,time:r()})},M=()=>{localStorage.getItem("userId")&&(g.value=!0,l.value=localStorage.getItem("userId")),N(),n.value.push({text:"è¿æ¥æˆåŠŸï¼šä»…æ˜¾ç¤ºè¿‘20æ¡è®°å½•",isMine:!1,time:r()})},C=a=>{try{const t=JSON.parse(a.data);if(!(t.type==="onlineCount"&&t.count!==void 0))if(t.type==="serverMessage"&&t.message)n.value.push({text:t.message,isMine:!1,time:r()});else if(t.type==="clientMessage"&&t.message&&t.userId){const u=t.userId===l.value,c=`${t.userId} ï¼š${t.message}`;n.value.push({text:c,isMine:u,time:r()})}else console.error("æœªçŸ¥çš„æ¶ˆæ¯ç±»å‹:",t)}catch(t){console.error("è§£ææ¶ˆæ¯å¤±è´¥:",a.data,t),n.value.push({text:"è§£ææ¶ˆæ¯å¤±è´¥",isMine:!1,time:r()})}},w=()=>{n.value.push({text:"è¿æ¥å·²å…³é—­",isMine:!1,time:r()})},V=async()=>{v.value=!0,e.value&&e.value.readyState===WebSocket.OPEN?(localStorage.setItem("userId",l.value),localStorage.getItem("userId")&&i.value.trim()===!0?(g.value=!0,l.value=localStorage.getItem("userId"),e.value.send(JSON.stringify({type:"clientMessage",message:i.value,userId:l.value,time:r()})),i.value="",N()):S.alert("è¯·è¾“å…¥åå­—å’Œå†…å®¹","â˜ï¸ğŸ¤“",{confirmButtonText:"OK"}),v.value=!1):(S.alert("â˜ï¸ğŸ¤“è¯·ç‚¹å‡»é‡æ–°è¿æ¥","è¿æ¥æœªæ‰“å¼€",{confirmButtonText:"OK"}),v.value=!1)},W=()=>{e.value&&e.value.readyState===WebSocket.OPEN&&e.value.close()},T=()=>{(!e.value||e.value.readyState!==WebSocket.CONNECTING)&&(e.value=new WebSocket(`ws://localhost:9800/ws/${y.value}`),e.value.onerror=x,e.value.onopen=M,e.value.onmessage=C,e.value.onclose=w)},r=()=>{const a=new Date,t=a.getFullYear(),u=String(a.getMonth()+1).padStart(2,"0"),c=String(a.getDate()).padStart(2,"0"),p=String(a.getHours()).padStart(2,"0"),s=String(a.getMinutes()).padStart(2,"0"),f=String(a.getSeconds()).padStart(2,"0");return`${t}-${u}-${c} ${p}:${s}:${f}`},N=()=>{m.value&&setTimeout(()=>{var a;(a=m.value)==null||a.scrollTo({top:m.value.scrollHeight,behavior:"smooth"})},20)};return D(()=>{W()}),F(()=>{e.value&&(e.value.onerror=x,e.value.onopen=M,e.value.onmessage=C,e.value.onclose=w)}),(a,t)=>{const u=$("el-button"),c=$("el-input"),p=K("loading");return d(),b("div",null,[h(u,{onClick:W},{default:_(()=>[k("å…³é—­è¿æ¥")]),_:1}),!e.value.value||e.value.value.readyState!==a.WebSocket.OPEN?(d(),B(u,{key:0,onClick:T},{default:_(()=>[k("é‡æ–°è¿æ¥")]),_:1})):P("",!0),I("div",{id:"message-container",ref_key:"messageContainer",ref:m},[(d(!0),b(R,null,U(n.value,(s,f)=>(d(),b("div",{key:f,class:z({"message-bubble":!0,mine:s.isMine,others:!s.isMine})},[I("span",J,O(s.time),1),I("p",null,O(s.text),1)],2))),128))],512),h(c,{id:"userId",type:"text",modelValue:l.value,"onUpdate:modelValue":t[0]||(t[0]=s=>l.value=s),disabled:g.value,maxlength:"10",placeholder:"è¯·è¾“å…¥æ‚¨çš„ID(ä½ åªèƒ½è¾“å…¥ä¸€æ¬¡ï¼Œè¯·è°¨æ…)"},null,8,["modelValue","disabled"]),h(c,{id:"text",type:"text",modelValue:i.value,"onUpdate:modelValue":t[1]||(t[1]=s=>i.value=s),maxlength:"30",placeholder:"è¯·è¾“å…¥å†…å®¹"},null,8,["modelValue"]),G((d(),B(u,{class:"btn-animate btn-animate__vibrate",type:"primary",onClick:V},{default:_(()=>[k("å‘é€æ¶ˆæ¯")]),_:1})),[[p,v.value]])])}}}),Y=H(L,[["__scopeId","data-v-0f09abb8"]]);export{Y as default};
