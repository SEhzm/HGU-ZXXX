import{r as f,K as ce,L as me,j as p,A as N,o as v,c as fe,G as h,T as P,f as t,d as e,e as o,k as U,p as s,l as y,R as B,m as C,D as q,x as he,v as _e}from"./index-BTaCMAQi.js";import{l as ge,g as ve,u as be,a as Ve,d as ye}from"./chapters-B7XnAofh.js";const we={class:"app-container"},Ue=C("div",{class:"el-upload__text"},[s(" Drop file here or "),C("em",null,"click to upload")],-1),Ce={class:"dialog-footer"},De=he({name:"Chapters"}),Ae=Object.assign(De,{setup(ke){const{proxy:_}=_e(),$=f([]),g=f(!1),I=f(!0),D=f(!0),x=f([]),R=f(!0),E=f(!0),A=f(0),S=f(""),z=ce({form:{},queryParams:{pageNum:1,pageSize:10,courseId:null,chapterTitle:null,chapterDescription:null,videoUrl:null,position:null,createdAt:null,updatedAt:null},rules:{}}),{queryParams:r,form:d,rules:F}=me(z),Q=f([]),j=(n,l,u)=>{console.log("上传成功",n)},G=(n,l,u)=>{console.error("上传失败",n)},O=n=>{const l=n.size/1024/1024<2;return l||ElMessage.error("上传文件大小不能超过 2MB!"),l},H=(n,l)=>{ElMessage.warning(`当前限制选择 3 个文件，本次选择了 ${n.length} 个文件，共选择了 ${n.length+l.length} 个文件`)};function b(){I.value=!0,ge(r.value).then(n=>{$.value=n.rows,A.value=n.total,I.value=!1})}function J(){g.value=!1,T()}function T(){d.value={chapterId:null,courseId:null,chapterTitle:null,chapterDescription:null,videoUrl:null,position:null,createdAt:null,updatedAt:null},_.resetForm("chaptersRef")}function V(){r.value.pageNum=1,b()}function W(){_.resetForm("queryRef"),V()}function X(n){x.value=n.map(l=>l.chapterId),R.value=n.length!=1,E.value=!n.length}function Z(){T(),g.value=!0,S.value="添加course_chapters"}function M(n){T();const l=n.chapterId||x.value;ve(l).then(u=>{d.value=u.data,g.value=!0,S.value="修改course_chapters"})}function ee(){_.$refs.chaptersRef.validate(n=>{n&&(d.value.chapterId!=null?be(d.value).then(l=>{_.$modal.msgSuccess("修改成功"),g.value=!1,b()}):Ve(d.value).then(l=>{_.$modal.msgSuccess("新增成功"),g.value=!1,b()}))})}function Y(n){const l=n.chapterId||x.value;_.$modal.confirm('是否确认删除course_chapters编号为"'+l+'"的数据项？').then(function(){return ye(l)}).then(()=>{b(),_.$modal.msgSuccess("删除成功")}).catch(()=>{})}function le(){_.download("course/chapters/export",{...r.value},`chapters_${new Date().getTime()}.xlsx`)}return b(),(n,l)=>{const u=p("el-input"),i=p("el-form-item"),K=p("el-date-picker"),c=p("el-button"),L=p("el-form"),k=p("el-col"),te=p("right-toolbar"),oe=p("el-row"),m=p("el-table-column"),ae=p("el-table"),ne=p("pagination"),re=p("upload-filled"),de=p("el-icon"),pe=p("el-upload"),ue=p("el-dialog"),w=N("hasPermi"),ie=N("loading");return v(),fe("div",we,[h(e(L,{model:t(r),ref:"queryRef",inline:!0,"label-width":"68px"},{default:o(()=>[e(i,{label:"课程id",prop:"courseId"},{default:o(()=>[e(u,{modelValue:t(r).courseId,"onUpdate:modelValue":l[0]||(l[0]=a=>t(r).courseId=a),placeholder:"请输入课程id",clearable:"",onKeyup:U(V,["enter"])},null,8,["modelValue"])]),_:1}),e(i,{label:"章节标题",prop:"chapterTitle"},{default:o(()=>[e(u,{modelValue:t(r).chapterTitle,"onUpdate:modelValue":l[1]||(l[1]=a=>t(r).chapterTitle=a),placeholder:"请输入章节标题",clearable:"",onKeyup:U(V,["enter"])},null,8,["modelValue"])]),_:1}),e(i,{label:"章节描述",prop:"chapterDescription"},{default:o(()=>[e(u,{modelValue:t(r).chapterDescription,"onUpdate:modelValue":l[2]||(l[2]=a=>t(r).chapterDescription=a),placeholder:"请输入章节描述",clearable:"",onKeyup:U(V,["enter"])},null,8,["modelValue"])]),_:1}),e(i,{label:"视频链接",prop:"videoUrl"},{default:o(()=>[e(u,{modelValue:t(r).videoUrl,"onUpdate:modelValue":l[3]||(l[3]=a=>t(r).videoUrl=a),placeholder:"请输入视频链接",clearable:"",onKeyup:U(V,["enter"])},null,8,["modelValue"])]),_:1}),e(i,{label:"章节顺序",prop:"position"},{default:o(()=>[e(u,{modelValue:t(r).position,"onUpdate:modelValue":l[4]||(l[4]=a=>t(r).position=a),placeholder:"请输入章节顺序",clearable:"",onKeyup:U(V,["enter"])},null,8,["modelValue"])]),_:1}),e(i,{label:"创建时间",prop:"createdAt"},{default:o(()=>[e(K,{clearable:"",modelValue:t(r).createdAt,"onUpdate:modelValue":l[5]||(l[5]=a=>t(r).createdAt=a),type:"date","value-format":"YYYY-MM-DD",placeholder:"请选择创建时间"},null,8,["modelValue"])]),_:1}),e(i,{label:"更新时间",prop:"updatedAt"},{default:o(()=>[e(K,{clearable:"",modelValue:t(r).updatedAt,"onUpdate:modelValue":l[6]||(l[6]=a=>t(r).updatedAt=a),type:"date","value-format":"YYYY-MM-DD",placeholder:"请选择更新时间"},null,8,["modelValue"])]),_:1}),e(i,null,{default:o(()=>[e(c,{type:"primary",icon:"Search",onClick:V},{default:o(()=>[s("搜索")]),_:1}),e(c,{icon:"Refresh",onClick:W},{default:o(()=>[s("重置")]),_:1})]),_:1})]),_:1},8,["model"]),[[P,t(D)]]),e(oe,{gutter:10,class:"mb8"},{default:o(()=>[e(k,{span:1.5},{default:o(()=>[h((v(),y(c,{type:"primary",plain:"",icon:"Plus",onClick:Z},{default:o(()=>[s("新增 ")]),_:1})),[[w,["course:chapters:add"]]])]),_:1}),e(k,{span:1.5},{default:o(()=>[h((v(),y(c,{type:"success",plain:"",icon:"Edit",disabled:t(R),onClick:M},{default:o(()=>[s("修改 ")]),_:1},8,["disabled"])),[[w,["course:chapters:edit"]]])]),_:1}),e(k,{span:1.5},{default:o(()=>[h((v(),y(c,{type:"danger",plain:"",icon:"Delete",disabled:t(E),onClick:Y},{default:o(()=>[s("删除 ")]),_:1},8,["disabled"])),[[w,["course:chapters:remove"]]])]),_:1}),e(k,{span:1.5},{default:o(()=>[h((v(),y(c,{type:"warning",plain:"",icon:"Download",onClick:le},{default:o(()=>[s("导出 ")]),_:1})),[[w,["course:chapters:export"]]])]),_:1}),e(te,{showSearch:t(D),"onUpdate:showSearch":l[7]||(l[7]=a=>B(D)?D.value=a:null),onQueryTable:b},null,8,["showSearch"])]),_:1}),h((v(),y(ae,{data:t($),onSelectionChange:X},{default:o(()=>[e(m,{type:"selection",width:"55",align:"center"}),e(m,{label:"章节id",align:"center",prop:"chapterId"}),e(m,{label:"课程id",align:"center",prop:"courseId"}),e(m,{label:"章节标题",align:"center",prop:"chapterTitle"}),e(m,{label:"章节描述",align:"center",prop:"chapterDescription","show-overflow-tooltip":""}),e(m,{label:"视频链接",align:"center",prop:"videoUrl","show-overflow-tooltip":""}),e(m,{label:"章节顺序",align:"center",prop:"position"}),e(m,{label:"创建时间",align:"center",prop:"createdAt",width:"180"},{default:o(a=>[C("span",null,q(n.parseTime(a.row.createdAt,"{y}-{m}-{d}")),1)]),_:1}),e(m,{label:"更新时间",align:"center",prop:"updatedAt",width:"180"},{default:o(a=>[C("span",null,q(n.parseTime(a.row.updatedAt,"{y}-{m}-{d}")),1)]),_:1}),e(m,{label:"操作",align:"center","class-name":"small-padding fixed-width"},{default:o(a=>[h((v(),y(c,{link:"",type:"primary",icon:"Edit",onClick:se=>M(a.row)},{default:o(()=>[s("修改 ")]),_:2},1032,["onClick"])),[[w,["course:chapters:edit"]]]),h((v(),y(c,{link:"",type:"primary",icon:"Delete",onClick:se=>Y(a.row)},{default:o(()=>[s("删除 ")]),_:2},1032,["onClick"])),[[w,["course:chapters:remove"]]])]),_:1})]),_:1},8,["data"])),[[ie,t(I)]]),h(e(ne,{total:t(A),page:t(r).pageNum,"onUpdate:page":l[8]||(l[8]=a=>t(r).pageNum=a),limit:t(r).pageSize,"onUpdate:limit":l[9]||(l[9]=a=>t(r).pageSize=a),onPagination:b},null,8,["total","page","limit"]),[[P,t(A)>0]]),e(ue,{title:t(S),modelValue:t(g),"onUpdate:modelValue":l[15]||(l[15]=a=>B(g)?g.value=a:null),width:"500px","append-to-body":""},{footer:o(()=>[C("div",Ce,[e(c,{type:"primary",onClick:ee},{default:o(()=>[s("确 定")]),_:1}),e(c,{onClick:J},{default:o(()=>[s("取 消")]),_:1})])]),default:o(()=>[e(L,{ref:"chaptersRef",model:t(d),rules:t(F),"label-width":"80px"},{default:o(()=>[e(i,{label:"课程id",prop:"courseId"},{default:o(()=>[e(u,{modelValue:t(d).courseId,"onUpdate:modelValue":l[10]||(l[10]=a=>t(d).courseId=a),placeholder:"请输入课程id"},null,8,["modelValue"])]),_:1}),e(i,{label:"章节标题",prop:"chapterTitle"},{default:o(()=>[e(u,{modelValue:t(d).chapterTitle,"onUpdate:modelValue":l[11]||(l[11]=a=>t(d).chapterTitle=a),placeholder:"请输入章节标题"},null,8,["modelValue"])]),_:1}),e(i,{label:"章节描述",prop:"chapterDescription"},{default:o(()=>[e(u,{modelValue:t(d).chapterDescription,"onUpdate:modelValue":l[12]||(l[12]=a=>t(d).chapterDescription=a),placeholder:"请输入章节描述"},null,8,["modelValue"])]),_:1}),e(i,{label:"视频链接",prop:"videoUrl"},{default:o(()=>[e(pe,{action:"/upload","on-success":j,"on-error":G,"before-upload":O,multiple:"",drag:"",limit:3,"on-exceed":H,"file-list":t(Q)},{default:o(()=>[e(de,{class:"el-icon--upload"},{default:o(()=>[e(re)]),_:1}),Ue]),_:1},8,["file-list"])]),_:1}),e(i,{label:"视频链接",prop:"videoUrl"},{default:o(()=>[e(u,{modelValue:t(d).videoUrl,"onUpdate:modelValue":l[13]||(l[13]=a=>t(d).videoUrl=a),placeholder:"请输入视频链接"},null,8,["modelValue"])]),_:1}),e(i,{label:"章节顺序",prop:"position"},{default:o(()=>[e(u,{modelValue:t(d).position,"onUpdate:modelValue":l[14]||(l[14]=a=>t(d).position=a),placeholder:"请输入章节顺序"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])}}});export{Ae as default};
